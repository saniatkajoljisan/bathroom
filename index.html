<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bathroom Clean Schedule - Live System</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/saniatkajoljisan/bathroom@latest/flip.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">

<style>
body { font-family:'Inter',sans-serif; background:#f3f4f7; margin:0; }
html { scroll-behavior:smooth; }

.modal{
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  align-items:center; justify-content:center;
  z-index:100; backdrop-filter:blur(4px);
}
.modal.active{ display:flex; }

table{ border-spacing:0; width:100%; border-radius:20px; }
th,td{ border-bottom:1px solid #f0f0f0; }

.box-shadow-custom{ box-shadow:0 20px 50px rgba(0,0,0,.05); }

.sticky-header{
  position:sticky; top:0; z-index:999;
  background:linear-gradient(135deg,rgba(38,135,231,.85),rgba(207,228,241,.65));
  backdrop-filter:blur(1px) saturate(180%);
  border-bottom:1px solid rgba(255,255,255,.25);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.35),0 8px 30px rgba(0,0,0,.15);
}
</style>
</head>

<body class="pb-10">

<div class="max-w-4xl mx-auto px-4 md:px-0 pt-4 md:pt-10 space-y-6">

<div class="bg-white box-shadow-custom rounded-[32px] border border-white">

<div class="sticky-header p-8 text-center text-white">
<h1 class="text-2xl md:text-4xl font-black tracking-tight drop-shadow-md">
Bathroom Clean Schedule
</h1>
<div id="live-indicator" class="text-[10px] opacity-90 font-bold mt-1 tracking-widest uppercase">
Connecting...
</div>
</div>

<!-- üîµ PROGRESS BARS -->
<div class="px-6 py-5 bg-blue-50/40 backdrop-blur-sm space-y-3">

<div>
<div class="flex justify-between text-[10px] font-black tracking-widest uppercase text-gray-600 mb-1">
<span>Total Status Ratio</span>
<span id="statusPercent">0%</span>
</div>
<div class="w-full h-2 rounded-full bg-blue-100 overflow-hidden">
<div id="statusBar" class="h-full w-0 rounded-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-500"></div>
</div>
</div>

<div>
<div class="flex justify-between text-[10px] font-black tracking-widest uppercase text-gray-600 mb-1">
<span>Total Approval Ratio</span>
<span id="approvalPercent">0%</span>
</div>
<div class="w-full h-2 rounded-full bg-blue-100 overflow-hidden">
<div id="approvalBar" class="h-full w-0 rounded-full bg-gradient-to-r from-indigo-400 to-indigo-600 transition-all duration-500"></div>
</div>
</div>

<!-- üÜï WAITING MESSAGE -->
<div id="waitingMsg"
class="text-center text-[10px] font-bold tracking-widest uppercase text-gray-400 hidden">
‚è≥ Waiting for admin final approval‚Ä¶
</div>
<div class="notice-box mb-2">
    <marquee id="monthMarquee" style="color: rgba(70, 153, 236, 0.85);padding: px;border-radius: 6px;border:1px solid #699ef5;margin-top: 5px;" behavior="scroll">After cleaning the bathroom, enter your name and update the status to (‚úÖ).</marquee>
</div>

</div>

<div class="overflow-x-auto">
<table class="text-left">
<thead class="bg-gray-50/50">
<tr class="text-gray-500 text-[11px] uppercase font-black tracking-widest">
<th class="p-6 text-center w-20">SL</th>
<th class="p-6 min-w-[180px]">Member Name</th>
<th class="p-6">Date (Friday)</th>
<th class="p-6 text-center w-32">Status</th>
<th class="p-6 text-center w-32 bg-blue-50/30">Final Approval</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</div>
<div style="background-color: rgba(70, 153, 236, 0.85); color: white; padding: px; border-radius: 6px; text-align: center; display: flex; justify-content: center; align-items: center;">Next Friday Left</div>
<div class="text-center">
      <div id="flipdownTimer" class="flipdown d-inline-block"></div>
  </div>
</div>

<p id="adminToggle"
onclick="window.toggleAdmin()"
class="text-center text-gray-400 text-[10px] mt-12 mb-8 tracking-[0.3em] font-bold uppercase cursor-pointer">
Dream City Mess - Skjisan
</p>

<!-- STATUS MODAL -->
<div id="selectionModal" class="modal">
<div class="bg-white p-8 rounded-[32px] shadow-2xl w-80 text-center">
<h3 class="text-lg font-black text-gray-800 mb-2 uppercase italic">Select Status</h3>
<p class="text-gray-400 text-[10px] mb-6 font-bold uppercase tracking-wider">
Warning: You Cannot Change It later
</p>

<div class="flex gap-3">
<button onclick="confirmAction('‚úî')" class="flex-1 bg-green-50 text-green-600 border-2 border-green-500 font-black py-4 rounded-2xl text-2xl">‚úî</button>
<button onclick="confirmAction('‚úò')" class="flex-1 bg-red-50 text-red-600 border-2 border-red-500 font-black py-4 rounded-2xl text-2xl">‚úò</button>
<button id="resetBtn" onclick="confirmAction('')" class="flex-1 bg-gray-50 text-gray-500 border-2 border-gray-300 font-black py-4 rounded-2xl text-xl hidden">‚Ü∫</button>
</div>

<button onclick="closeModal()" class="mt-6 text-gray-400 text-[10px] font-black uppercase tracking-widest">
Close
</button>
</div>
</div>

<!-- CYCLE MODAL -->
<div id="cycleModal" class="modal">
<div class="bg-white p-10 rounded-[32px] shadow-2xl w-96 text-center">
<div class="text-green-500 text-4xl mb-4 font-black">‚úî</div>
<h3 class="text-xl font-black text-gray-800 mb-2 uppercase">
Cycle Completed
</h3>
<p id="nextCycleText" class="text-gray-500 text-sm font-bold mb-6"></p>
<button onclick="closeCycleModal()" class="px-8 py-3 rounded-2xl bg-blue-600 text-white font-black tracking-widest text-sm">
OK
</button>
</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyAlXlbUD2nlMsH7VtCiS9NjkMzpcDl38iE",
authDomain:"bathroom-clean-c35e0.firebaseapp.com",
databaseURL:"https://bathroom-clean-c35e0-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"bathroom-clean-c35e0",
storageBucket:"bathroom-clean-c35e0.firebasestorage.app",
messagingSenderId:"1060489726116",
appId:"1:1060489726116:web:46c68029ecd2b216463e31"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dbRef=ref(db,'clean_system');

let appData={}, memberNames=["Name","Name","Name","Name","Name","Name"];
let activeCellId=null,isAdmin=false,startFriday=null;

const getNextFriday=d=>{
d=new Date(d);
d.setDate(d.getDate()+((5-d.getDay()+7)%7||7));
return d;
};

onValue(dbRef,async snap=>{
const data=snap.val()||{};
appData=data.status||{};
memberNames=data.names||memberNames;

if(!data.startFriday){
startFriday=getNextFriday(new Date());
await update(dbRef,{startFriday:startFriday.toISOString()});
}else startFriday=new Date(data.startFriday);

document.getElementById('live-indicator').innerHTML=
'<span class="flex items-center justify-center gap-1.5"><span class="text-green-400 text-lg">‚óè</span>Live Sync Active</span>';

renderUI();
});

function renderUI(){
const tbody=document.getElementById('table-body');
tbody.innerHTML='';
let d=new Date(startFriday), sc=0, ac=0;

for(let i=0;i<6;i++){
const k=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
const s=appData[k]||'', a=appData[k+'_appr']||'';
if(s) sc++; if(a) ac++;

tbody.insertAdjacentHTML('beforeend',`
<tr class="hover:bg-indigo-50/30">
<td class="p-6 text-center text-gray-300 font-black">${i+1}</td>
<td class="p-6">
<input placeholder="${memberNames[i] || 'Name'}" 
       value="${memberNames[i] && memberNames[i] !== 'Name' ? memberNames[i] : ''}" 
       onchange="saveName(${i},this.value || 'Name')"
       ${s&&!isAdmin?'readonly':''}
       class="w-full bg-transparent font-semibold ${s&&!isAdmin?'text-gray-400':'text-gray-600'} outline-none placeholder-gray-300">
</td>
<td class="p-6 text-gray-400 font-bold text-sm">
${d.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}
</td>
<td class="p-6 text-center">
<div onclick="${(!s||isAdmin)?`openModal('${k}')`:''}"
class="w-12 h-12 mx-auto flex items-center justify-center rounded-2xl border-2 font-black text-xl
${s?s==='‚úî'?'text-green-600 bg-green-50 border-transparent':'text-red-600 bg-red-50 border-transparent'
:'border-dashed border-gray-200 text-gray-300 cursor-pointer'}">${s}</div>
</td>
<td class="p-6 text-center bg-blue-50/10">
<div onclick="${isAdmin?`openModal('${k}_appr')`:''}"
class="w-12 h-12 mx-auto flex items-center justify-center rounded-2xl border-2 font-black text-xl
${a?a==='‚úî'?'text-blue-600 bg-blue-100 border-transparent':'text-orange-600 bg-orange-100 border-transparent'
:isAdmin?'border-blue-300 text-blue-300 cursor-pointer':'text-transparent'}">${a}</div>
</td>
</tr>`);
d.setDate(d.getDate()+7);
}

const sp=Math.round((sc/6)*100);
const ap=Math.round((ac/6)*100);

document.getElementById('statusBar').style.width=sp+'%';
document.getElementById('approvalBar').style.width=ap+'%';
document.getElementById('statusPercent').innerText=sp+'%';
document.getElementById('approvalPercent').innerText=ap+'%';

/* üÜï waiting message logic */
const waitMsg=document.getElementById('waitingMsg');
if(sc===6 && ac<6){
waitMsg.classList.remove('hidden');
}else{
waitMsg.classList.add('hidden');
}

document.getElementById('adminToggle').innerText =
isAdmin ? 'ADMIN MODE ¬∑ LOGOUT' : 'Dream City Mess - Skjisan';
}

function cycleComplete(){
let d=new Date(startFriday);
for(let i=0;i<6;i++){
const k=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
if(!appData[k]||!appData[k+'_appr']) return false;
d.setDate(d.getDate()+7);
}
return true;
}

window.toggleAdmin=()=>{
if(!isAdmin){
const p=prompt("Admin Password:");
if(p==="sk77"){
isAdmin=true;
alert("Admin Mode Active");
renderUI();
}
}else{
isAdmin=false;
renderUI();
}
};

window.confirmAction=async status=>{
if(!activeCellId) return;
await update(ref(db,'clean_system/status'),{[activeCellId]:status});

if(isAdmin && activeCellId.endsWith('_appr') && cycleComplete()){
const next=new Date(startFriday);
next.setDate(next.getDate()+7);
document.getElementById('nextCycleText').innerText=
`Next cycle starts from: ${next.toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}`;
document.getElementById('cycleModal').classList.add('active');
await update(dbRef,{startFriday:next.toISOString(),status:{}});
}

closeModal();
};

window.openModal=id=>{
activeCellId=id;
document.getElementById('selectionModal').classList.add('active');
document.getElementById('resetBtn').classList.toggle('hidden',!isAdmin);
};
window.closeModal=()=>{
document.getElementById('selectionModal').classList.remove('active');
activeCellId=null;
};
window.closeCycleModal=()=>document.getElementById('cycleModal').classList.remove('active');
window.saveName=(i,v)=>{
    memberNames[i]=v.trim() === '' ? 'Name' : v.trim();
    update(dbRef,{names:memberNames});
};
</script>
<script src="https://cdn.jsdelivr.net/gh/saniatkajoljisan/bathroom/flip.js"></script>

</body>
</html>
