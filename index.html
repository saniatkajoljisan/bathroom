<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bathroom Clean Schedule - Live System</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">

<style>
body { font-family:'Inter',sans-serif; background:#f3f4f7; margin:0; }
html { scroll-behavior:smooth; }

.modal{
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.6);
  align-items:center; justify-content:center;
  z-index:100; backdrop-filter:blur(4px);
}
.modal.active{ display:flex; }

table{ border-spacing:0; width:100%; border-radius:20px; }
th,td{ border-bottom:1px solid #f0f0f0; }

.box-shadow-custom{ box-shadow:0 20px 50px rgba(0,0,0,.05); }

.sticky-header{
  position:sticky; top:0; z-index:999;
  background:linear-gradient(135deg,rgba(38,135,231,.85),rgba(207,228,241,.65));
  backdrop-filter:blur(1px) saturate(180%);
  border-bottom:1px solid rgba(255,255,255,.25);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.35),0 8px 30px rgba(0,0,0,.15);
}
/* THEMES */

/********** Theme: dark **********/
/* Font styles */
.rotor-bottom, .rotor, .rotor-leaf-front, .rotor-leaf-rear, .rotor-top {
      background-color: rgba(84, 159, 235, 0.85)!important;
    }

    .countdown, .countdown-circles {
      text-transform: uppercase;
      font-weight: bold;
    }

    .countdown span {
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 3rem;
      margin-left: 0.8rem;
    }

    .countdown span:first-of-type {
      margin-left: 0;
    }

    .countdown-circles span {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }

    .countdown-circles span:first-of-type {
      margin-left: 0;
    }

    /* Center FlipDown timer */
    #flipdownTimer {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px auto;
    }

    .marquee-box a {
      font-size: 15px;
      text-decoration: none;
    }
.flipdown.flipdown__theme-dark {
  font-family: sans-serif;
  font-weight: bold;
}
/* Rotor group headings */
.flipdown.flipdown__theme-dark .rotor-group-heading:before {
  color: #000000;
}
/* Delimeters */
.flipdown.flipdown__theme-dark .rotor-group:nth-child(n+2):nth-child(-n+3):before,
.flipdown.flipdown__theme-dark .rotor-group:nth-child(n+2):nth-child(-n+3):after {
  background-color: #151515;
}
/* Rotor tops */
.flipdown.flipdown__theme-dark .rotor,
.flipdown.flipdown__theme-dark .rotor-top,
.flipdown.flipdown__theme-dark .rotor-leaf-front {
  color: #FFFFFF;
  background-color: #151515;
}
/* Rotor bottoms */
.flipdown.flipdown__theme-dark .rotor-bottom,
.flipdown.flipdown__theme-dark .rotor-leaf-rear {
  color: #EFEFEF;
  background-color: #202020;
}
/* Hinge */
.flipdown.flipdown__theme-dark .rotor:after {
  border-top: solid 1px #151515;
}

/********** Theme: light **********/
/* Font styles */
.flipdown.flipdown__theme-light {
  font-family: sans-serif;
  font-weight: bold;
}
/* Rotor group headings */
.flipdown.flipdown__theme-light .rotor-group-heading:before {
  color: #EEEEEE;
}
/* Delimeters */
.flipdown.flipdown__theme-light .rotor-group:nth-child(n+2):nth-child(-n+3):before,
.flipdown.flipdown__theme-light .rotor-group:nth-child(n+2):nth-child(-n+3):after {
  background-color: #DDDDDD;
}
/* Rotor tops */
.flipdown.flipdown__theme-light .rotor,
.flipdown.flipdown__theme-light .rotor-top,
.flipdown.flipdown__theme-light .rotor-leaf-front {
  color: #222222;
  background-color: #DDDDDD;
}
/* Rotor bottoms */
.flipdown.flipdown__theme-light .rotor-bottom,
.flipdown.flipdown__theme-light .rotor-leaf-rear {
  color: #333333;
  background-color: #EEEEEE;
}
/* Hinge */
.flipdown.flipdown__theme-light .rotor:after {
  border-top: solid 1px #222222;
}

/* END OF THEMES */

.flipdown {
  overflow: visible;
  width: 510px;
  height: 110px;
}

.flipdown .rotor-group {
  position: relative;
  float: left;
  padding-right: 30px;
}

.flipdown .rotor-group:last-child {
  padding-right: 0;
}

.flipdown .rotor-group-heading:before {
  display: block;
  height: 30px;
  line-height: 30px;
  text-align: center;
}

.flipdown .rotor-group:nth-child(1) .rotor-group-heading:before {
  content: attr(data-before);
}

.flipdown .rotor-group:nth-child(2) .rotor-group-heading:before {
  content: attr(data-before);
}

.flipdown .rotor-group:nth-child(3) .rotor-group-heading:before {
  content: attr(data-before);
}

.flipdown .rotor-group:nth-child(4) .rotor-group-heading:before {
  content: attr(data-before);
}

.flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):before {
  content: '';
  position: absolute;
  bottom: 20px;
  left: 115px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):after {
  content: '';
  position: absolute;
  bottom: 50px;
  left: 115px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.flipdown .rotor {
  position: relative;
  float: left;
  width: 50px;
  height: 80px;
  margin: 0px 5px 0px 0px;
  border-radius: 4px;
  font-size: 4rem;
  text-align: center;
  perspective: 200px;
}

.flipdown .rotor:last-child {
  margin-right: 0;
}

.flipdown .rotor-top,
.flipdown .rotor-bottom {
  overflow: hidden;
  position: absolute;
  width: 50px;
  height: 40px;
}

.flipdown .rotor-leaf {
  z-index: 1;
  position: absolute;
  width: 50px;
  height: 80px;
  transform-style: preserve-3d;
  transition: transform 0s;
}

.flipdown .rotor-leaf.flipped {
  transform: rotateX(-180deg);
  transition: all 0.5s ease-in-out;
}

.flipdown .rotor-leaf-front,
.flipdown .rotor-leaf-rear {
  overflow: hidden;
  position: absolute;
  width: 50px;
  height: 40px;
  margin: 0;
  transform: rotateX(0deg);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.flipdown .rotor-leaf-front {
  line-height: 80px;
  border-radius: 4px 4px 0px 0px;
}

.flipdown .rotor-leaf-rear {
  line-height: 0px;
  border-radius: 0px 0px 4px 4px;
  transform: rotateX(-180deg);
}

.flipdown .rotor-top {
  line-height: 80px;
  border-radius: 4px 4px 0px 0px;
}

.flipdown .rotor-bottom {
  bottom: 0;
  line-height: 0px;
  border-radius: 0px 0px 4px 4px;
}

.flipdown .rotor:after {
  content: '';
  z-index: 2;
  position: absolute;
  bottom: 0px;
  left: 0px;
  width: 50px;
  height: 40px;
  border-radius: 0px 0px 4px 4px;
}

@media (max-width: 550px) {

  .flipdown {
    width: 312px;
    height: 70px;
  }

  .flipdown .rotor {
    font-size: 2.2rem;
    margin-right: 3px;
  }

  .flipdown .rotor,
  .flipdown .rotor-leaf,
  .flipdown .rotor-leaf-front,
  .flipdown .rotor-leaf-rear,
  .flipdown .rotor-top,
  .flipdown .rotor-bottom,
  .flipdown .rotor:after {
    width: 30px;
  }

  .flipdown .rotor-group {
    padding-right: 15px;
  }

  .flipdown .rotor-group:last-child {
    padding-right: 0px;
  }

  .flipdown .rotor-group-heading:before {
    font-size: 0.8rem;
    height: 20px;
    line-height: 20px;
  }

  .flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):before,
  .flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):after {
    left: 69px;
  }

  .flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):before {
    bottom: 13px;
    height: 8px;
    width: 8px;
  }

  .flipdown .rotor-group:nth-child(n+2):nth-child(-n+3):after {
    bottom: 29px;
    height: 8px;
    width: 8px;
  }

  .flipdown .rotor-leaf-front,
  .flipdown .rotor-top {
    line-height: 50px;
  }

  .flipdown .rotor-leaf,
  .flipdown .rotor {
    height: 50px;
  }

  .flipdown .rotor-leaf-front,
  .flipdown .rotor-leaf-rear,
  .flipdown .rotor-top,
  .flipdown .rotor-bottom,
  .flipdown .rotor:after {
    height: 25px;
  }
}
</style>
</head>

<body class="pb-10">

<div class="max-w-4xl mx-auto px-4 md:px-0 pt-4 md:pt-10 space-y-6">

<div class="bg-white box-shadow-custom rounded-[32px] border border-white">

<div class="sticky-header p-8 text-center text-white">
<h1 class="text-2xl md:text-4xl font-black tracking-tight drop-shadow-md">
Bathroom Clean Schedule
</h1>
<div id="live-indicator" class="text-[10px] opacity-90 font-bold mt-1 tracking-widest uppercase">
Connecting...
</div>
</div>

<!-- üîµ PROGRESS BARS -->
<div class="px-6 py-5 bg-blue-50/40 backdrop-blur-sm space-y-3">

<div>
<div class="flex justify-between text-[10px] font-black tracking-widest uppercase text-gray-600 mb-1">
<span>Status Progress</span>
<span id="statusPercent">0%</span>
</div>
<div class="w-full h-2 rounded-full bg-blue-100 overflow-hidden">
<div id="statusBar" class="h-full w-0 rounded-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-500"></div>
</div>
</div>

<div>
<div class="flex justify-between text-[10px] font-black tracking-widest uppercase text-gray-600 mb-1">
<span>Approval Progress</span>
<span id="approvalPercent">0%</span>
</div>
<div class="w-full h-2 rounded-full bg-blue-100 overflow-hidden">
<div id="approvalBar" class="h-full w-0 rounded-full bg-gradient-to-r from-indigo-400 to-indigo-600 transition-all duration-500"></div>
</div>
</div>

<!-- üÜï WAITING MESSAGE -->
<div id="waitingMsg"
class="text-center text-[10px] font-bold tracking-widest uppercase text-gray-400 hidden">
‚è≥ Waiting for admin approval‚Ä¶
</div>
<div class="notice-box mb-2">
    <marquee id="monthMarquee" style="color: rgba(70, 153, 236, 0.85);padding: px;border-radius: 6px;border:1px solid #699ef5;margin-top: 5px;" behavior="scroll">After cleaning the bathroom, enter your name and update the status.</marquee>
</div>

</div>

<div class="overflow-x-auto">
<table class="text-left">
<thead class="bg-gray-50/50">
<tr class="text-gray-500 text-[11px] uppercase font-black tracking-widest">
<th class="p-6 text-center w-20">SL</th>
<th class="p-6 min-w-[180px]">Member Name</th>
<th class="p-6">Date (Friday)</th>
<th class="p-6 text-center w-32">Status</th>
<th class="p-6 text-center w-32 bg-blue-50/30">Final Approval</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

</div>
<div style="background-color: rgba(70, 153, 236, 0.85); color: white; padding: px; border-radius: 6px; text-align: center; display: flex; justify-content: center; align-items: center;">Next Friday Left</div>
<div class="text-center">
      <div id="flipdownTimer" class="flipdown d-inline-block"></div>
  </div>
</div>

<p id="adminToggle"
onclick="window.toggleAdmin()"
class="text-center text-gray-400 text-[10px] mt-12 mb-8 tracking-[0.3em] font-bold uppercase cursor-pointer">
Dream City Mess - Skjisan
</p>

<!-- STATUS MODAL -->
<div id="selectionModal" class="modal">
<div class="bg-white p-8 rounded-[32px] shadow-2xl w-80 text-center">
<h3 class="text-lg font-black text-gray-800 mb-2 uppercase italic">Select Status</h3>
<p class="text-gray-400 text-[10px] mb-6 font-bold uppercase tracking-wider">
Warning: Cannot be edited later
</p>

<div class="flex gap-3">
<button onclick="confirmAction('‚úî')" class="flex-1 bg-green-50 text-green-600 border-2 border-green-500 font-black py-4 rounded-2xl text-2xl">‚úî</button>
<button onclick="confirmAction('‚úò')" class="flex-1 bg-red-50 text-red-600 border-2 border-red-500 font-black py-4 rounded-2xl text-2xl">‚úò</button>
<button id="resetBtn" onclick="confirmAction('')" class="flex-1 bg-gray-50 text-gray-500 border-2 border-gray-300 font-black py-4 rounded-2xl text-xl hidden">‚Ü∫</button>
</div>

<button onclick="closeModal()" class="mt-6 text-gray-400 text-[10px] font-black uppercase tracking-widest">
Cancel
</button>
</div>
</div>

<!-- CYCLE MODAL -->
<div id="cycleModal" class="modal">
<div class="bg-white p-10 rounded-[32px] shadow-2xl w-96 text-center">
<div class="text-green-500 text-4xl mb-4 font-black">‚úî</div>
<h3 class="text-xl font-black text-gray-800 mb-2 uppercase">
Cycle Completed
</h3>
<p id="nextCycleText" class="text-gray-500 text-sm font-bold mb-6"></p>
<button onclick="closeCycleModal()" class="px-8 py-3 rounded-2xl bg-blue-600 text-white font-black tracking-widest text-sm">
OK
</button>
</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyAlXlbUD2nlMsH7VtCiS9NjkMzpcDl38iE",
authDomain:"bathroom-clean-c35e0.firebaseapp.com",
databaseURL:"https://bathroom-clean-c35e0-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"bathroom-clean-c35e0",
storageBucket:"bathroom-clean-c35e0.firebasestorage.app",
messagingSenderId:"1060489726116",
appId:"1:1060489726116:web:46c68029ecd2b216463e31"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dbRef=ref(db,'clean_system');

let appData={}, memberNames=["Member 1","Member 2","Member 3","Member 4","Member 5","Member 6"];
let activeCellId=null,isAdmin=false,startFriday=null;

const getNextFriday=d=>{
d=new Date(d);
d.setDate(d.getDate()+((5-d.getDay()+7)%7||7));
return d;
};

onValue(dbRef,async snap=>{
const data=snap.val()||{};
appData=data.status||{};
memberNames=data.names||memberNames;

if(!data.startFriday){
startFriday=getNextFriday(new Date());
await update(dbRef,{startFriday:startFriday.toISOString()});
}else startFriday=new Date(data.startFriday);

document.getElementById('live-indicator').innerHTML=
'<span class="flex items-center justify-center gap-1.5"><span class="text-green-400 text-lg">‚óè</span>Live Sync Active</span>';

renderUI();
});

function renderUI(){
const tbody=document.getElementById('table-body');
tbody.innerHTML='';
let d=new Date(startFriday), sc=0, ac=0;

for(let i=0;i<6;i++){
const k=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
const s=appData[k]||'', a=appData[k+'_appr']||'';
if(s) sc++; if(a) ac++;

tbody.insertAdjacentHTML('beforeend',`
<tr class="hover:bg-indigo-50/30">
<td class="p-6 text-center text-gray-300 font-black">${i+1}</td>
<td class="p-6">
<input value="${memberNames[i]||''}" onchange="saveName(${i},this.value)"
${s&&!isAdmin?'readonly':''}
class="w-full bg-transparent font-bold ${s&&!isAdmin?'text-gray-400':'text-gray-600'} outline-none">
</td>
<td class="p-6 text-gray-400 font-bold text-sm">
${d.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}
</td>
<td class="p-6 text-center">
<div onclick="${(!s||isAdmin)?`openModal('${k}')`:''}"
class="w-12 h-12 mx-auto flex items-center justify-center rounded-2xl border-2 font-black text-xl
${s?s==='‚úî'?'text-green-600 bg-green-50 border-transparent':'text-red-600 bg-red-50 border-transparent'
:'border-dashed border-gray-200 text-gray-300 cursor-pointer'}">${s}</div>
</td>
<td class="p-6 text-center bg-blue-50/10">
<div onclick="${isAdmin?`openModal('${k}_appr')`:''}"
class="w-12 h-12 mx-auto flex items-center justify-center rounded-2xl border-2 font-black text-xl
${a?a==='‚úî'?'text-blue-600 bg-blue-100 border-transparent':'text-orange-600 bg-orange-100 border-transparent'
:isAdmin?'border-blue-300 text-blue-300 cursor-pointer':'text-transparent'}">${a}</div>
</td>
</tr>`);
d.setDate(d.getDate()+7);
}

const sp=Math.round((sc/6)*100);
const ap=Math.round((ac/6)*100);

document.getElementById('statusBar').style.width=sp+'%';
document.getElementById('approvalBar').style.width=ap+'%';
document.getElementById('statusPercent').innerText=sp+'%';
document.getElementById('approvalPercent').innerText=ap+'%';

/* üÜï waiting message logic */
const waitMsg=document.getElementById('waitingMsg');
if(sc===6 && ac<6){
waitMsg.classList.remove('hidden');
}else{
waitMsg.classList.add('hidden');
}

document.getElementById('adminToggle').innerText =
isAdmin ? 'ADMIN MODE ¬∑ LOGOUT' : 'Dream City Mess - Skjisan';
}

function cycleComplete(){
let d=new Date(startFriday);
for(let i=0;i<6;i++){
const k=`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
if(!appData[k]||!appData[k+'_appr']) return false;
d.setDate(d.getDate()+7);
}
return true;
}

window.toggleAdmin=()=>{
if(!isAdmin){
const p=prompt("Admin Password:");
if(p==="sk77"){
isAdmin=true;
alert("Admin Mode Active");
renderUI();
}
}else{
isAdmin=false;
renderUI();
}
};

window.confirmAction=async status=>{
if(!activeCellId) return;
await update(ref(db,'clean_system/status'),{[activeCellId]:status});

if(isAdmin && activeCellId.endsWith('_appr') && cycleComplete()){
const next=new Date(startFriday);
next.setDate(next.getDate()+7);
document.getElementById('nextCycleText').innerText=
`Next cycle starts from: ${next.toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}`;
document.getElementById('cycleModal').classList.add('active');
await update(dbRef,{startFriday:next.toISOString(),status:{}});
}

closeModal();
};

window.openModal=id=>{
activeCellId=id;
document.getElementById('selectionModal').classList.add('active');
document.getElementById('resetBtn').classList.toggle('hidden',!isAdmin);
};
window.closeModal=()=>{
document.getElementById('selectionModal').classList.remove('active');
activeCellId=null;
};
window.closeCycleModal=()=>document.getElementById('cycleModal').classList.remove('active');
window.saveName=(i,v)=>{memberNames[i]=v;update(dbRef,{names:memberNames});};
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {

  function getNextFridayTimestamp() {
    const now = new Date();
    const day = now.getDay(); 

   
    let daysUntilFriday = (5 - day + 7) % 7;
    if (daysUntilFriday === 0) daysUntilFriday = 7; 

    const nextFriday = new Date(now);
    nextFriday.setDate(now.getDate() + daysUntilFriday);
    nextFriday.setHours(23, 59, 59, 999); 

    return Math.floor(nextFriday.getTime() / 1000);
  }

  function startFlipdown() {
    const nextFridayTimestamp = getNextFridayTimestamp();
    console.log('Next Friday timestamp:', nextFridayTimestamp);

    new FlipDown(nextFridayTimestamp, 'flipdownTimer')
      .start()
      .ifEnded(() => {
        console.log('Friday countdown ended. Restarting...');
        startFlipdown(); 
      });
  }

  startFlipdown();
});

"use strict";

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var FlipDown = function () {
  function FlipDown(uts) {
    var el = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "flipdown";
    var opt = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

    _classCallCheck(this, FlipDown);

    if (typeof uts !== "number") {
      throw new Error("FlipDown: Constructor expected unix timestamp, got ".concat(_typeof(uts), " instead."));
    }

    if (_typeof(el) === "object") {
      opt = el;
      el = "flipdown";
    }

    this.version = "0.3.2";
    this.initialised = false;
    this.now = this._getTime();
    this.epoch = uts;
    this.countdownEnded = false;
    this.hasEndedCallback = null;
    this.element = document.getElementById(el);
    this.rotors = [];
    this.rotorLeafFront = [];
    this.rotorLeafRear = [];
    this.rotorTops = [];
    this.rotorBottoms = [];
    this.countdown = null;
    this.daysRemaining = 0;
    this.clockValues = {};
    this.clockStrings = {};
    this.clockValuesAsString = [];
    this.prevClockValuesAsString = [];
    this.opts = this._parseOptions(opt);

    this._setOptions();

    console.log("FlipDown ".concat(this.version, " (Theme: ").concat(this.opts.theme, ")"));
  }

  _createClass(FlipDown, [{
    key: "start",
    value: function start() {
      if (!this.initialised) this._init();
      this.countdown = setInterval(this._tick.bind(this), 1000);
      return this;
    }
  }, {
    key: "ifEnded",
    value: function ifEnded(cb) {
      this.hasEndedCallback = function () {
        cb();
        this.hasEndedCallback = null;
      };

      return this;
    }
  }, {
    key: "_getTime",
    value: function _getTime() {
      return new Date().getTime() / 1000;
    }
  }, {
    key: "_hasCountdownEnded",
    value: function _hasCountdownEnded() {
      if (this.epoch - this.now < 0) {
        this.countdownEnded = true;

        if (this.hasEndedCallback != null) {
          this.hasEndedCallback();
          this.hasEndedCallback = null;
        }

        return true;
      } else {
        this.countdownEnded = false;
        return false;
      }
    }
  }, {
    key: "_parseOptions",
    value: function _parseOptions(opt) {
      var headings = ["Days", "Hours", "Minutes", "Seconds"];

      if (opt.headings && opt.headings.length === 4) {
        headings = opt.headings;
      }

      return {
        theme: opt.hasOwnProperty("theme") ? opt.theme : "dark",
        headings: headings
      };
    }
  }, {
    key: "_setOptions",
    value: function _setOptions() {
      this.element.classList.add("flipdown__theme-".concat(this.opts.theme));
    }
  }, {
    key: "_init",
    value: function _init() {
      this.initialised = true;

      if (this._hasCountdownEnded()) {
        this.daysremaining = 0;
      } else {
        this.daysremaining = Math.floor((this.epoch - this.now) / 86400).toString().length;
      }

      var dayRotorCount = this.daysremaining <= 2 ? 2 : this.daysremaining;

      for (var i = 0; i < dayRotorCount + 6; i++) {
        this.rotors.push(this._createRotor(0));
      }

      var dayRotors = [];

      for (var i = 0; i < dayRotorCount; i++) {
        dayRotors.push(this.rotors[i]);
      }

      this.element.appendChild(this._createRotorGroup(dayRotors, 0));
      var count = dayRotorCount;

      for (var i = 0; i < 3; i++) {
        var otherRotors = [];

        for (var j = 0; j < 2; j++) {
          otherRotors.push(this.rotors[count]);
          count++;
        }

        this.element.appendChild(this._createRotorGroup(otherRotors, i + 1));
      }

      this.rotorLeafFront = Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-front"));
      this.rotorLeafRear = Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-rear"));
      this.rotorTop = Array.prototype.slice.call(this.element.getElementsByClassName("rotor-top"));
      this.rotorBottom = Array.prototype.slice.call(this.element.getElementsByClassName("rotor-bottom"));

      this._tick();

      this._updateClockValues(true);

      return this;
    }
  }, {
    key: "_createRotorGroup",
    value: function _createRotorGroup(rotors, rotorIndex) {
      var rotorGroup = document.createElement("div");
      rotorGroup.className = "rotor-group";
      var dayRotorGroupHeading = document.createElement("div");
      dayRotorGroupHeading.className = "rotor-group-heading";
      dayRotorGroupHeading.setAttribute("data-before", this.opts.headings[rotorIndex]);
      rotorGroup.appendChild(dayRotorGroupHeading);
      appendChildren(rotorGroup, rotors);
      return rotorGroup;
    }
  }, {
    key: "_createRotor",
    value: function _createRotor() {
      var v = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var rotor = document.createElement("div");
      var rotorLeaf = document.createElement("div");
      var rotorLeafRear = document.createElement("figure");
      var rotorLeafFront = document.createElement("figure");
      var rotorTop = document.createElement("div");
      var rotorBottom = document.createElement("div");
      rotor.className = "rotor";
      rotorLeaf.className = "rotor-leaf";
      rotorLeafRear.className = "rotor-leaf-rear";
      rotorLeafFront.className = "rotor-leaf-front";
      rotorTop.className = "rotor-top";
      rotorBottom.className = "rotor-bottom";
      rotorLeafRear.textContent = v;
      rotorTop.textContent = v;
      rotorBottom.textContent = v;
      appendChildren(rotor, [rotorLeaf, rotorTop, rotorBottom]);
      appendChildren(rotorLeaf, [rotorLeafRear, rotorLeafFront]);
      return rotor;
    }
  }, {
    key: "_tick",
    value: function _tick() {
      this.now = this._getTime();
      var diff = this.epoch - this.now <= 0 ? 0 : this.epoch - this.now;
      this.clockValues.d = Math.floor(diff / 86400);
      diff -= this.clockValues.d * 86400;
      this.clockValues.h = Math.floor(diff / 3600);
      diff -= this.clockValues.h * 3600;
      this.clockValues.m = Math.floor(diff / 60);
      diff -= this.clockValues.m * 60;
      this.clockValues.s = Math.floor(diff);

      this._updateClockValues();

      this._hasCountdownEnded();
    }
  }, {
    key: "_updateClockValues",
    value: function _updateClockValues() {
      var _this = this;

      var init = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      this.clockStrings.d = pad(this.clockValues.d, 2);
      this.clockStrings.h = pad(this.clockValues.h, 2);
      this.clockStrings.m = pad(this.clockValues.m, 2);
      this.clockStrings.s = pad(this.clockValues.s, 2);
      this.clockValuesAsString = (this.clockStrings.d + this.clockStrings.h + this.clockStrings.m + this.clockStrings.s).split("");
      this.rotorLeafFront.forEach(function (el, i) {
        el.textContent = _this.prevClockValuesAsString[i];
      });
      this.rotorBottom.forEach(function (el, i) {
        el.textContent = _this.prevClockValuesAsString[i];
      });

      function rotorTopFlip() {
        var _this2 = this;

        this.rotorTop.forEach(function (el, i) {
          if (el.textContent != _this2.clockValuesAsString[i]) {
            el.textContent = _this2.clockValuesAsString[i];
          }
        });
      }

      function rotorLeafRearFlip() {
        var _this3 = this;

        this.rotorLeafRear.forEach(function (el, i) {
          if (el.textContent != _this3.clockValuesAsString[i]) {
            el.textContent = _this3.clockValuesAsString[i];
            el.parentElement.classList.add("flipped");
            var flip = setInterval(function () {
              el.parentElement.classList.remove("flipped");
              clearInterval(flip);
            }.bind(_this3), 500);
          }
        });
      }

      if (!init) {
        setTimeout(rotorTopFlip.bind(this), 500);
        setTimeout(rotorLeafRearFlip.bind(this), 500);
      } else {
        rotorTopFlip.call(this);
        rotorLeafRearFlip.call(this);
      }

      this.prevClockValuesAsString = this.clockValuesAsString;
    }
  }]);

  return FlipDown;
}();

function pad(n, len) {
  n = n.toString();
  return n.length < len ? pad("0" + n, len) : n;
}

function appendChildren(parent, children) {
  children.forEach(function (el) {
    parent.appendChild(el);
  });
}
</script>

</body>
</html>
